<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>开发一个简单的登录插件 | Bukkit Development Note α</title>
    <meta name="description" content="Bukkit Development Note Alpha is a guide about how to develope a plugin with BukkitAPI.">
    <meta name="generator" content="VuePress 1.4.0">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.slim.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.2/jquery.fancybox.min.js"></script>
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.2/jquery.fancybox.min.css">
    
    <link rel="preload" href="/BukkitDevelopmentNoteAlpha/assets/css/0.styles.47035bf9.css" as="style"><link rel="preload" href="/BukkitDevelopmentNoteAlpha/assets/js/app.e1f3861f.js" as="script"><link rel="preload" href="/BukkitDevelopmentNoteAlpha/assets/js/2.cc6e75aa.js" as="script"><link rel="preload" href="/BukkitDevelopmentNoteAlpha/assets/js/28.23479591.js" as="script"><link rel="prefetch" href="/BukkitDevelopmentNoteAlpha/assets/js/10.1ccdbd96.js"><link rel="prefetch" href="/BukkitDevelopmentNoteAlpha/assets/js/11.a89d6a64.js"><link rel="prefetch" href="/BukkitDevelopmentNoteAlpha/assets/js/12.d106061e.js"><link rel="prefetch" href="/BukkitDevelopmentNoteAlpha/assets/js/13.ae4e9c02.js"><link rel="prefetch" href="/BukkitDevelopmentNoteAlpha/assets/js/14.8e323878.js"><link rel="prefetch" href="/BukkitDevelopmentNoteAlpha/assets/js/15.c4c88afd.js"><link rel="prefetch" href="/BukkitDevelopmentNoteAlpha/assets/js/16.b13d0230.js"><link rel="prefetch" href="/BukkitDevelopmentNoteAlpha/assets/js/17.567cf58d.js"><link rel="prefetch" href="/BukkitDevelopmentNoteAlpha/assets/js/18.465e278e.js"><link rel="prefetch" href="/BukkitDevelopmentNoteAlpha/assets/js/19.29af88fd.js"><link rel="prefetch" href="/BukkitDevelopmentNoteAlpha/assets/js/20.c4fbb199.js"><link rel="prefetch" href="/BukkitDevelopmentNoteAlpha/assets/js/21.7f6de141.js"><link rel="prefetch" href="/BukkitDevelopmentNoteAlpha/assets/js/22.b44f9a0c.js"><link rel="prefetch" href="/BukkitDevelopmentNoteAlpha/assets/js/23.2e5108c9.js"><link rel="prefetch" href="/BukkitDevelopmentNoteAlpha/assets/js/24.9516e2b6.js"><link rel="prefetch" href="/BukkitDevelopmentNoteAlpha/assets/js/25.dff2cf05.js"><link rel="prefetch" href="/BukkitDevelopmentNoteAlpha/assets/js/26.2b210e48.js"><link rel="prefetch" href="/BukkitDevelopmentNoteAlpha/assets/js/27.06567ebe.js"><link rel="prefetch" href="/BukkitDevelopmentNoteAlpha/assets/js/29.9fba1cdc.js"><link rel="prefetch" href="/BukkitDevelopmentNoteAlpha/assets/js/3.8f6ad4d5.js"><link rel="prefetch" href="/BukkitDevelopmentNoteAlpha/assets/js/4.2f54bf03.js"><link rel="prefetch" href="/BukkitDevelopmentNoteAlpha/assets/js/5.00152988.js"><link rel="prefetch" href="/BukkitDevelopmentNoteAlpha/assets/js/6.3893f5f8.js"><link rel="prefetch" href="/BukkitDevelopmentNoteAlpha/assets/js/7.dab76dec.js"><link rel="prefetch" href="/BukkitDevelopmentNoteAlpha/assets/js/8.ecf73e06.js"><link rel="prefetch" href="/BukkitDevelopmentNoteAlpha/assets/js/9.cd5eafec.js">
    <link rel="stylesheet" href="/BukkitDevelopmentNoteAlpha/assets/css/0.styles.47035bf9.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/BukkitDevelopmentNoteAlpha/" class="home-link router-link-active"><!----> <span class="site-name">Bukkit Development Note α</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/BukkitDevelopmentNoteAlpha/home.html" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/BukkitDevelopmentNoteAlpha/contribute.html" class="nav-link">
  贡献
</a></div><div class="nav-item"><a href="/BukkitDevelopmentNoteAlpha/donate.html" class="nav-link">
  赞助
</a></div><div class="nav-item"><a href="https://github.com/BakaRinya/BukkitDevelopmentNoteAlpha" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub仓库
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/BukkitDevelopmentNoteAlpha/home.html" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/BukkitDevelopmentNoteAlpha/contribute.html" class="nav-link">
  贡献
</a></div><div class="nav-item"><a href="/BukkitDevelopmentNoteAlpha/donate.html" class="nav-link">
  赞助
</a></div><div class="nav-item"><a href="https://github.com/BakaRinya/BukkitDevelopmentNoteAlpha" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub仓库
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/BukkitDevelopmentNoteAlpha/home.html" class="sidebar-link">欢迎</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Step1: 基本操作</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/BukkitDevelopmentNoteAlpha/step_1/0-1.html" class="sidebar-link">写在前面</a></li><li><a href="/BukkitDevelopmentNoteAlpha/step_1/1-1.html" class="sidebar-link">认识Java和面向对象</a></li><li><a href="/BukkitDevelopmentNoteAlpha/step_1/1-2.html" class="sidebar-link">编写一个插件</a></li><li><a href="/BukkitDevelopmentNoteAlpha/step_1/0-2.html" class="sidebar-link">后记</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Step2: 语言基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Step3: 开发插件</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/BukkitDevelopmentNoteAlpha/step_3/0-3.html" class="sidebar-link">JavaDoc的使用</a></li><li><a href="/BukkitDevelopmentNoteAlpha/step_3/1-2.html" class="sidebar-link">事件</a></li><li><a href="/BukkitDevelopmentNoteAlpha/step_3/1-1.html" class="sidebar-link">MC的对象化</a></li><li><a href="/BukkitDevelopmentNoteAlpha/step_3/1-3.html" class="sidebar-link">配置API</a></li><li><a href="/BukkitDevelopmentNoteAlpha/step_3/1-4.html" class="sidebar-link">命令执行器</a></li><li><a href="/BukkitDevelopmentNoteAlpha/step_3/1-5.html" class="active sidebar-link">开发一个简单的登录插件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/BukkitDevelopmentNoteAlpha/step_3/1-5.html#插件制作思路" class="sidebar-link">插件制作思路</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/BukkitDevelopmentNoteAlpha/step_3/1-5.html#如何做我想做的功能" class="sidebar-link">如何做我想做的功能</a></li><li class="sidebar-sub-header"><a href="/BukkitDevelopmentNoteAlpha/step_3/1-5.html#数据如何储存" class="sidebar-link">数据如何储存</a></li></ul></li><li class="sidebar-sub-header"><a href="/BukkitDevelopmentNoteAlpha/step_3/1-5.html#基本准备" class="sidebar-link">基本准备</a></li><li class="sidebar-sub-header"><a href="/BukkitDevelopmentNoteAlpha/step_3/1-5.html#开始开发" class="sidebar-link">开始开发</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/BukkitDevelopmentNoteAlpha/step_3/1-5.html#loginmanager" class="sidebar-link">LoginManager</a></li><li class="sidebar-sub-header"><a href="/BukkitDevelopmentNoteAlpha/step_3/1-5.html#事件监听" class="sidebar-link">事件监听</a></li><li class="sidebar-sub-header"><a href="/BukkitDevelopmentNoteAlpha/step_3/1-5.html#指令" class="sidebar-link">指令</a></li><li class="sidebar-sub-header"><a href="/BukkitDevelopmentNoteAlpha/step_3/1-5.html#在主类和plugin-yml注册" class="sidebar-link">在主类和plugin.yml注册</a></li></ul></li><li class="sidebar-sub-header"><a href="/BukkitDevelopmentNoteAlpha/step_3/1-5.html#后记" class="sidebar-link">后记</a></li></ul></li><li><a href="/BukkitDevelopmentNoteAlpha/step_3/0-2.html" class="sidebar-link">后记</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="开发一个简单的登录插件"><a href="#开发一个简单的登录插件" class="header-anchor">#</a> 开发一个简单的登录插件</h1> <p>你已经对Bukkit中常见且重要的系统有了初步的认识. 那么如何利用这些认识写一个Bukkit插件呢?<br>
下面以一款非常简单的登录插件的开发为例, 详细讲述一个插件是怎么被开发出来的.</p> <p>请你在下面的内容中<strong>着重注意领悟插件制作的思路</strong>.</p> <p><em>我们假设服务端测试环境只有我们自己做的那个插件.</em></p> <h2 id="插件制作思路"><a href="#插件制作思路" class="header-anchor">#</a> 插件制作思路</h2> <h3 id="如何做我想做的功能"><a href="#如何做我想做的功能" class="header-anchor">#</a> 如何做我想做的功能</h3> <p>如果你想做登录插件, 你需要监听登录事件和玩家的输入事件; 如果你想做小游戏, 你可能会监听玩家的移动、右键等事件.</p> <p>由此看来, 插件往往基于事件. 事件的监听是一个插件的灵魂.<br>
插件往往就是监听事件触发后执行某个代码, 由此运行的.<br>
在制作插件前的设计过程当中, 不妨思考一下 &quot;我的插件应该监听哪些事件&quot;, 然后去寻找BukkitAPI中这些事件的对应的类, 监听它们.</p> <p>每个开发者都会在插件制作过程中经常查看JavaDoc. 这是插件制作所必须的.</p> <h3 id="数据如何储存"><a href="#数据如何储存" class="header-anchor">#</a> 数据如何储存</h3> <p>在学习Java基础的过程中, 你一定学习到了<code>Map</code>、<code>List</code>等类型. 这些类型在插件编写当中非常常见.</p> <p>如果我们想做一个登录插件, 也许我们会把没有登录的玩家名称加在一个<code>List</code>里, 然后监听很多事件, 诸如<code>PlayerMoveEvent</code>、<code>PlayerChatEvent</code>等, 利用<code>List.contains</code>就可以判断出玩家是不是登录了, 然后通过控制<code>event.setCancelled</code>方法控制是否禁止事件, 这就完成了登录插件的基本结构了.</p> <p>如果我想实现 关闭服务器后再打开还能保留 的数据, 这种功能的实现思路往往是: 保存数据到配置文件-&gt;把数据文件读取出来.<br>
也就是要学会利用配置文件, 配置文件不只是能帮助你储存配置, 一定要意识到!</p> <h2 id="基本准备"><a href="#基本准备" class="header-anchor">#</a> 基本准备</h2> <p>首先我们要写好基本的主类和<code>plugin.yml</code>, 引入服务端Jar作为Lib. 我这里创建了<code>StupidLogin</code>工程作为演示, <code>plugin.yml</code>目前设置了<code>name</code> <code>version</code> <code>main</code> <code>author</code>, 主类目前如下:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">rinya<span class="token punctuation">.</span>bukkit<span class="token punctuation">.</span>stupidlogin</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StupidLogin</span> <span class="token keyword">extends</span> <span class="token class-name">JavaPlugin</span> <span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">StupidLogin</span> instance<span class="token punctuation">;</span>
	
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onEnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		instance <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>		
		<span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;StupidLogin插件启动！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onDisable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;StupidLogin插件已经卸载.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>然后我们大致设计一下这个插件, 其实这个插件工作原理我已经不必多说, 你应该清楚了:</p> <blockquote><p><strong>登录注册部分</strong></p> <ol><li>注册登录注册指令.</li> <li>监听玩家进入服务器, 把玩家的名字写在 未登录玩家 的List当中.</li> <li>玩家登录或注册.(这里注册后还需要输入登录指令)</li> <li>玩家输入登录指令后, 把玩家名从 未登录玩家 List 里去掉.</li></ol></blockquote> <blockquote><p><strong>然后再写一个<code>Listener</code>, 监听玩家各种事件例如<code>PlayerMoveEvent</code>等, 在玩家未登录时禁止这些事件</strong>.</p></blockquote> <p><strong>在开头提醒: 不能监听PlayerEvent、EntityEvent或诸如此类的事件! 限制玩家未登录时的行动必须需要监听一遍所有事件!</strong></p> <h2 id="开始开发"><a href="#开始开发" class="header-anchor">#</a> 开始开发</h2> <h3 id="loginmanager"><a href="#loginmanager" class="header-anchor">#</a> LoginManager</h3> <p>LoginManager有 查询玩家是否登录、查询是否注册、注册玩家账号、修改是否登录的状态、查询字符串与玩家密码是否一致 的五个功能.</p> <p>首先先写出基本的结构, 把构思中的 未登录玩家 的List写出:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LoginManager</span> <span class="token punctuation">{</span>
	<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> unloginList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//获取玩家是否登录</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">isLogin</span><span class="token punctuation">(</span><span class="token class-name">String</span> playerName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token operator">!</span>unloginList<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>playerName<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//如果玩家名字没在列表里就返回true, 代表已经登录</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">//设置玩家登录状态，flag=true为登录, false为未登录</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">setPlayerLogin</span><span class="token punctuation">(</span><span class="token class-name">String</span> playerName<span class="token punctuation">,</span> <span class="token keyword">boolean</span> flag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			unloginList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>playerName<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//设置为true就会把玩家从未登录玩家里删除</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			unloginList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>playerName<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//反之添加</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>然后再写出与配置文件有关的三个方法:</p> <div class="language-java extra-class"><pre class="language-java"><code>	<span class="token comment">//判断玩家是否注册账号</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">isRegister</span><span class="token punctuation">(</span><span class="token class-name">String</span> playerName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	    <span class="token comment">//如果配置文件里有  player_data.玩家名  这个键就代表已经注册</span>
		<span class="token keyword">return</span> <span class="token class-name">StupidLogin</span><span class="token punctuation">.</span>instance<span class="token punctuation">.</span><span class="token function">getConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">&quot;player_data.&quot;</span><span class="token operator">+</span>playerName<span class="token punctuation">)</span><span class="token punctuation">;</span> 
	<span class="token punctuation">}</span>
	
	<span class="token comment">//让玩家注册账号</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name">String</span> playerName<span class="token punctuation">,</span> <span class="token class-name">String</span> password<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isRegister</span><span class="token punctuation">(</span>playerName<span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">//如果已经注册就return，阻止下面的操作</span>
			
		<span class="token comment">//设置  player_data.玩家名.password 键为玩家的密码字符串</span>
		<span class="token class-name">StupidLogin</span><span class="token punctuation">.</span>instance<span class="token punctuation">.</span><span class="token function">getConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;player_data.&quot;</span><span class="token operator">+</span>playerName<span class="token operator">+</span><span class="token string">&quot;.password&quot;</span><span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span> 
		<span class="token class-name">StupidLogin</span><span class="token punctuation">.</span>instance<span class="token punctuation">.</span><span class="token function">saveConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//设置完了别忘了保存！</span>
		<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">//判断密码是否正确</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">isCorrectPassword</span><span class="token punctuation">(</span><span class="token class-name">String</span> playerName<span class="token punctuation">,</span> <span class="token class-name">String</span> password<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isRegister</span><span class="token punctuation">(</span>playerName<span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">//没注册能正确就怪了！</span>
		
		<span class="token comment">//pass是玩家注册的密码</span>
		<span class="token class-name">String</span> pass <span class="token operator">=</span> <span class="token class-name">StupidLogin</span><span class="token punctuation">.</span>instance<span class="token punctuation">.</span><span class="token function">getConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;player_data.&quot;</span><span class="token operator">+</span>playerName<span class="token operator">+</span><span class="token string">&quot;.password&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> pass<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//返回结果</span>
	<span class="token punctuation">}</span>
</code></pre></div><h3 id="事件监听"><a href="#事件监听" class="header-anchor">#</a> 事件监听</h3> <p>然后编写监听器.</p> <p>首先先编写<code>PlayerLimitListener</code>, 用以禁止 玩家未登录时做的操作 ,并且在玩家登录和退出服务器时把玩家加进 未登录玩家 List 里.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">rinya<span class="token punctuation">.</span>bukkit<span class="token punctuation">.</span>stupidlogin<span class="token punctuation">.</span>listener</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>bukkit<span class="token punctuation">.</span>event</span><span class="token punctuation">.</span><span class="token class-name">EventHandler</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>bukkit<span class="token punctuation">.</span>event</span><span class="token punctuation">.</span><span class="token class-name">Listener</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>bukkit<span class="token punctuation">.</span>event<span class="token punctuation">.</span>inventory</span><span class="token punctuation">.</span><span class="token class-name">InventoryOpenEvent</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>bukkit<span class="token punctuation">.</span>event<span class="token punctuation">.</span>player</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">rinya<span class="token punctuation">.</span>bukkit<span class="token punctuation">.</span>stupidlogin</span><span class="token punctuation">.</span><span class="token class-name">LoginManager</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PlayerLimitListener</span> <span class="token keyword">implements</span> <span class="token class-name">Listener</span> <span class="token punctuation">{</span>

	<span class="token comment">//这里只是把几个常见的情况进行了拦截，玩家说话、玩家鼠标操作和玩家移动.</span>
	<span class="token comment">//你可以在这里按照这样的方式添加更多的拦截，使其更加安全</span>
	
	<span class="token annotation punctuation">@EventHandler</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onPlayerChat</span><span class="token punctuation">(</span><span class="token class-name">PlayerChatEvent</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//不让聊天</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//这里不拦截玩家用命令, 后面我们会处理一下限制玩家用命令</span>
			<span class="token keyword">return</span><span class="token punctuation">;</span>
		e<span class="token punctuation">.</span><span class="token function">setCancelled</span><span class="token punctuation">(</span><span class="token function">needCancelled</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getPlayer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token annotation punctuation">@EventHandler</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onPlayerMove</span><span class="token punctuation">(</span><span class="token class-name">PlayerMoveEvent</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//不让玩家移动</span>
		e<span class="token punctuation">.</span><span class="token function">setCancelled</span><span class="token punctuation">(</span><span class="token function">needCancelled</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getPlayer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token annotation punctuation">@EventHandler</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onPlayerInteract</span><span class="token punctuation">(</span><span class="token class-name">PlayerInteractEvent</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//不让玩家跟别的东西交互，约等于屏蔽左右键</span>
		e<span class="token punctuation">.</span><span class="token function">setCancelled</span><span class="token punctuation">(</span><span class="token function">needCancelled</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getPlayer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token annotation punctuation">@EventHandler</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onPlayerInventory</span><span class="token punctuation">(</span><span class="token class-name">InventoryOpenEvent</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//不让玩家打开背包</span>
		e<span class="token punctuation">.</span><span class="token function">setCancelled</span><span class="token punctuation">(</span><span class="token function">needCancelled</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getPlayer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token keyword">private</span> <span class="token keyword">boolean</span> <span class="token function">needCancelled</span><span class="token punctuation">(</span><span class="token class-name">String</span> playerName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token operator">!</span><span class="token class-name">LoginManager</span><span class="token punctuation">.</span><span class="token function">isLogin</span><span class="token punctuation">(</span>playerName<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">// 下面的两个监听用来修改玩家的登录状态</span>
	<span class="token annotation punctuation">@EventHandler</span>
	<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">onPlayerJoin</span><span class="token punctuation">(</span><span class="token class-name">PlayerJoinEvent</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">LoginManager</span><span class="token punctuation">.</span><span class="token function">setPlayerLogin</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getPlayer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token annotation punctuation">@EventHandler</span>
	<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">onPlayerQuit</span><span class="token punctuation">(</span><span class="token class-name">PlayerQuitEvent</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">LoginManager</span><span class="token punctuation">.</span><span class="token function">setPlayerLogin</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getPlayer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>为了体现我们的友♂好, 在玩家上线时给玩家发一个提示:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">rinya<span class="token punctuation">.</span>bukkit<span class="token punctuation">.</span>stupidlogin<span class="token punctuation">.</span>listener</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>bukkit<span class="token punctuation">.</span>event</span><span class="token punctuation">.</span><span class="token class-name">EventHandler</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>bukkit<span class="token punctuation">.</span>event</span><span class="token punctuation">.</span><span class="token class-name">Listener</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>bukkit<span class="token punctuation">.</span>event<span class="token punctuation">.</span>player</span><span class="token punctuation">.</span><span class="token class-name">PlayerJoinEvent</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">rinya<span class="token punctuation">.</span>bukkit<span class="token punctuation">.</span>stupidlogin</span><span class="token punctuation">.</span><span class="token class-name">LoginManager</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PlayerTipListener</span> <span class="token keyword">implements</span> <span class="token class-name">Listener</span> <span class="token punctuation">{</span>
	
	<span class="token comment">//玩家进入服务器后的“请您登录”提示语</span>
	<span class="token annotation punctuation">@EventHandler</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onPlayerJoin</span><span class="token punctuation">(</span><span class="token class-name">PlayerJoinEvent</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		e<span class="token punctuation">.</span><span class="token function">getPlayer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span>
					<span class="token class-name">LoginManager</span><span class="token punctuation">.</span><span class="token function">isRegister</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getPlayer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">?</span>
							<span class="token string">&quot;欢迎回来！请输入/login 密码 登录服务器！&quot;</span><span class="token operator">:</span>
							<span class="token string">&quot;欢迎第一次来到本服务器！请输入/register 密码 注册账号！&quot;</span>
				<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h3 id="指令"><a href="#指令" class="header-anchor">#</a> 指令</h3> <p>我认为指令部分可以通过代码看懂我的意思.<br>
在这里我会将login指令和register指令都放在这一个<code>CommandExecutor</code>里.</p> <p>对了, 要养成整理整齐<code>onCommand</code>方法的好习惯哦!</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">rinya<span class="token punctuation">.</span>bukkit<span class="token punctuation">.</span>stupidlogin<span class="token punctuation">.</span>command</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>bukkit</span><span class="token punctuation">.</span><span class="token class-name">ChatColor</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>bukkit<span class="token punctuation">.</span>command</span><span class="token punctuation">.</span><span class="token class-name">Command</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>bukkit<span class="token punctuation">.</span>command</span><span class="token punctuation">.</span><span class="token class-name">CommandExecutor</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>bukkit<span class="token punctuation">.</span>command</span><span class="token punctuation">.</span><span class="token class-name">CommandSender</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>bukkit<span class="token punctuation">.</span>entity</span><span class="token punctuation">.</span><span class="token class-name">Player</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>bukkit<span class="token punctuation">.</span>event</span><span class="token punctuation">.</span><span class="token class-name">EventHandler</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>bukkit<span class="token punctuation">.</span>event</span><span class="token punctuation">.</span><span class="token class-name">Listener</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>bukkit<span class="token punctuation">.</span>event<span class="token punctuation">.</span>player</span><span class="token punctuation">.</span><span class="token class-name">PlayerCommandPreprocessEvent</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">rinya<span class="token punctuation">.</span>bukkit<span class="token punctuation">.</span>stupidlogin</span><span class="token punctuation">.</span><span class="token class-name">LoginManager</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PlayerLoginCommand</span> <span class="token keyword">implements</span> <span class="token class-name">Listener</span><span class="token punctuation">,</span> <span class="token class-name">CommandExecutor</span> <span class="token punctuation">{</span>
	<span class="token annotation punctuation">@EventHandler</span> <span class="token comment">//用来拦截除了登录插件以外的指令</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onPlayerCommand</span><span class="token punctuation">(</span><span class="token class-name">PlayerCommandPreprocessEvent</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token class-name">LoginManager</span><span class="token punctuation">.</span><span class="token function">isLogin</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getPlayer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
			<span class="token keyword">return</span><span class="token punctuation">;</span>
		
		e<span class="token punctuation">.</span><span class="token function">setCancelled</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">&quot;login&quot;</span><span class="token punctuation">)</span> 
				<span class="token operator">||</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">&quot;register&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
			e<span class="token punctuation">.</span><span class="token function">setCancelled</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">onCommand</span><span class="token punctuation">(</span><span class="token class-name">CommandSender</span> sender<span class="token punctuation">,</span> <span class="token class-name">Command</span> cmd<span class="token punctuation">,</span> <span class="token class-name">String</span> label<span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>sender <span class="token keyword">instanceof</span> <span class="token class-name">Player</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
			<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
		
		<span class="token class-name">Player</span> p <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Player</span><span class="token punctuation">)</span>sender<span class="token punctuation">;</span>
		
		<span class="token keyword">if</span><span class="token punctuation">(</span>cmd<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span><span class="token string">&quot;login&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token function">loginCommand</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>cmd<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span><span class="token string">&quot;register&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token function">registerCommand</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">loginCommand</span><span class="token punctuation">(</span><span class="token class-name">Player</span> p<span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">LoginManager</span><span class="token punctuation">.</span><span class="token function">isLogin</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			p<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token string">&quot;你已经登录了！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">LoginManager</span><span class="token punctuation">.</span><span class="token function">isRegister</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			p<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token class-name">ChatColor</span><span class="token punctuation">.</span>RED<span class="token operator">+</span><span class="token string">&quot;你还没有注册！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>args<span class="token punctuation">.</span>length<span class="token operator">!=</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			p<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token class-name">ChatColor</span><span class="token punctuation">.</span>RED<span class="token operator">+</span><span class="token string">&quot;登录指令使用错误！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">LoginManager</span><span class="token punctuation">.</span><span class="token function">isCorrectPassword</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			p<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token class-name">ChatColor</span><span class="token punctuation">.</span>GREEN<span class="token operator">+</span><span class="token string">&quot;登录成功！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token class-name">LoginManager</span><span class="token punctuation">.</span><span class="token function">setPlayerLogin</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	
	<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">registerCommand</span><span class="token punctuation">(</span><span class="token class-name">Player</span> p<span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">LoginManager</span><span class="token punctuation">.</span><span class="token function">isLogin</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			p<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token string">&quot;你已经登录了！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">LoginManager</span><span class="token punctuation">.</span><span class="token function">isRegister</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			p<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token string">&quot;你已经登录了！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>args<span class="token punctuation">.</span>length<span class="token operator">!=</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			p<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token class-name">ChatColor</span><span class="token punctuation">.</span>RED<span class="token operator">+</span><span class="token string">&quot;注册指令使用错误！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token class-name">LoginManager</span><span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		p<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token class-name">ChatColor</span><span class="token punctuation">.</span>GREEN<span class="token operator">+</span><span class="token string">&quot;注册成功！请登录！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="在主类和plugin-yml注册"><a href="#在主类和plugin-yml注册" class="header-anchor">#</a> 在主类和plugin.yml注册</h3> <p>我们需要把监听器和命令在主类和<code>plugin.yml</code>中进行注册.</p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">name</span><span class="token punctuation">:</span> StupidLogin
<span class="token key atrule">main</span><span class="token punctuation">:</span> rinya.bukkit.stupidlogin.StupidLogin
<span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token number">1</span>
<span class="token key atrule">author</span><span class="token punctuation">:</span> rinya

<span class="token key atrule">commands</span><span class="token punctuation">:</span>
  <span class="token key atrule">login</span><span class="token punctuation">:</span>
    <span class="token key atrule">usage</span><span class="token punctuation">:</span> <span class="token string">&quot;/login YOUR_PASSWORD&quot;</span>
    <span class="token key atrule">description</span><span class="token punctuation">:</span> <span class="token string">&quot;Login your account.&quot;</span>
  <span class="token key atrule">register</span><span class="token punctuation">:</span>
    <span class="token key atrule">usage</span><span class="token punctuation">:</span> <span class="token string">&quot;/register YOUR_PASSWORD&quot;</span>
    <span class="token key atrule">description</span><span class="token punctuation">:</span> <span class="token string">&quot;Register your account.&quot;</span>
</code></pre></div><p>在<code>plugin.yml</code>中的注册需要注意<strong>不能出现中文, 请全英文</strong>! 编码推荐UTF-8.</p> <p>然后就是在主类注册一下了! <code>onEnable</code>方法内添加:</p> <div class="language-java extra-class"><pre class="language-java"><code>		<span class="token comment">//Configuration</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">saveDefaultConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//输出默认配置</span>
		<span class="token comment">//Listener</span>
		<span class="token class-name">Bukkit</span><span class="token punctuation">.</span><span class="token function">getPluginManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">registerEvents</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PlayerLimitListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//注册监听器</span>
		<span class="token class-name">Bukkit</span><span class="token punctuation">.</span><span class="token function">getPluginManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">registerEvents</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PlayerLoginCommand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">Bukkit</span><span class="token punctuation">.</span><span class="token function">getPluginManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">registerEvents</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PlayerTipListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//Commands</span>
		<span class="token class-name">CommandExecutor</span> ce <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PlayerLoginCommand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//注册指令，这里两个指令公用同一个Executor</span>
		<span class="token class-name">Bukkit</span><span class="token punctuation">.</span><span class="token function">getPluginCommand</span><span class="token punctuation">(</span><span class="token string">&quot;login&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setExecutor</span><span class="token punctuation">(</span>ce<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">Bukkit</span><span class="token punctuation">.</span><span class="token function">getPluginCommand</span><span class="token punctuation">(</span><span class="token string">&quot;register&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setExecutor</span><span class="token punctuation">(</span>ce<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="后记"><a href="#后记" class="header-anchor">#</a> 后记</h2> <p>至此, StupidLogin 已经完成! 希望你能阅读一下源码, 体会一下写这个插件的思路!</p> <p>但是这个登录插件的功能未免显得简单. 有这些缺陷:</p> <ol><li>如果玩家密码带空格, 这个插件会出现问题. (提示: 需要对onCommand的args做处理, 做出玩家密码带空格时真正想输入的密码)</li> <li>玩家名大小写可能会存在缺陷.</li></ol> <blockquote><p>在早期时有一款登录插件叫做PlayerLogin, 这款插件存在这样的问题:<br>
如果一个OP名字用ID abc 登录服务器中，拥有OP权限，那么一个不知道其密码的普通玩家可以通过ID Abc、ABC等更改大小写的ID登录服务器中，而登录插件却判定这个ID从未被注册过，可实际上Abc或ABc对于Minecraft服务器而言都有OP权限.<br>
本节中做的StupidLogin插件实际上也有这个问题，只要更改一个大小写，玩家也许就可以获得OP.</p> <p>你可以尝试思考如何解决这一问题.<br> <em>Tips: 常规的思路是将玩家名中英文字母全部转换为小写，尤其是在判断注册时应以小写判断.</em></p></blockquote> <ol start="3"><li><code>PlayerLimitListener</code>监听的事件太少, 可能有想不到的地方. (建议: 反编译或看开源的源代码, 看看AuthMe是如何做禁止的)</li> <li><code>login</code>、<code>register</code>输入起来太麻烦, 没有简便指令.</li> <li>没有更换密码功能.<br>
还可能有其他各种问题......</li></ol> <p>这些问题如何解决呢? 你来动手试一下吧!</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/BukkitDevelopmentNoteAlpha/step_3/1-4.html" class="prev">
        命令执行器
      </a></span> <span class="next"><a href="/BukkitDevelopmentNoteAlpha/step_3/0-2.html">
        后记
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/BukkitDevelopmentNoteAlpha/assets/js/app.e1f3861f.js" defer></script><script src="/BukkitDevelopmentNoteAlpha/assets/js/2.cc6e75aa.js" defer></script><script src="/BukkitDevelopmentNoteAlpha/assets/js/28.23479591.js" defer></script>
  </body>
</html>
