<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>事件 | Bukkit Development Note α</title>
    <meta name="description" content="Bukkit Development Note Alpha is a guide about how to develope a plugin with BukkitAPI.">
    <meta name="generator" content="VuePress 1.4.0">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.slim.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.2/jquery.fancybox.min.js"></script>
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.2/jquery.fancybox.min.css">
    
    <link rel="preload" href="/BukkitDevelopmentNoteAlpha/assets/css/0.styles.47035bf9.css" as="style"><link rel="preload" href="/BukkitDevelopmentNoteAlpha/assets/js/app.e1f3861f.js" as="script"><link rel="preload" href="/BukkitDevelopmentNoteAlpha/assets/js/2.cc6e75aa.js" as="script"><link rel="preload" href="/BukkitDevelopmentNoteAlpha/assets/js/25.dff2cf05.js" as="script"><link rel="prefetch" href="/BukkitDevelopmentNoteAlpha/assets/js/10.1ccdbd96.js"><link rel="prefetch" href="/BukkitDevelopmentNoteAlpha/assets/js/11.a89d6a64.js"><link rel="prefetch" href="/BukkitDevelopmentNoteAlpha/assets/js/12.d106061e.js"><link rel="prefetch" href="/BukkitDevelopmentNoteAlpha/assets/js/13.ae4e9c02.js"><link rel="prefetch" href="/BukkitDevelopmentNoteAlpha/assets/js/14.8e323878.js"><link rel="prefetch" href="/BukkitDevelopmentNoteAlpha/assets/js/15.c4c88afd.js"><link rel="prefetch" href="/BukkitDevelopmentNoteAlpha/assets/js/16.b13d0230.js"><link rel="prefetch" href="/BukkitDevelopmentNoteAlpha/assets/js/17.567cf58d.js"><link rel="prefetch" href="/BukkitDevelopmentNoteAlpha/assets/js/18.465e278e.js"><link rel="prefetch" href="/BukkitDevelopmentNoteAlpha/assets/js/19.29af88fd.js"><link rel="prefetch" href="/BukkitDevelopmentNoteAlpha/assets/js/20.c4fbb199.js"><link rel="prefetch" href="/BukkitDevelopmentNoteAlpha/assets/js/21.7f6de141.js"><link rel="prefetch" href="/BukkitDevelopmentNoteAlpha/assets/js/22.b44f9a0c.js"><link rel="prefetch" href="/BukkitDevelopmentNoteAlpha/assets/js/23.2e5108c9.js"><link rel="prefetch" href="/BukkitDevelopmentNoteAlpha/assets/js/24.9516e2b6.js"><link rel="prefetch" href="/BukkitDevelopmentNoteAlpha/assets/js/26.2b210e48.js"><link rel="prefetch" href="/BukkitDevelopmentNoteAlpha/assets/js/27.06567ebe.js"><link rel="prefetch" href="/BukkitDevelopmentNoteAlpha/assets/js/28.23479591.js"><link rel="prefetch" href="/BukkitDevelopmentNoteAlpha/assets/js/29.9fba1cdc.js"><link rel="prefetch" href="/BukkitDevelopmentNoteAlpha/assets/js/3.8f6ad4d5.js"><link rel="prefetch" href="/BukkitDevelopmentNoteAlpha/assets/js/4.2f54bf03.js"><link rel="prefetch" href="/BukkitDevelopmentNoteAlpha/assets/js/5.00152988.js"><link rel="prefetch" href="/BukkitDevelopmentNoteAlpha/assets/js/6.3893f5f8.js"><link rel="prefetch" href="/BukkitDevelopmentNoteAlpha/assets/js/7.dab76dec.js"><link rel="prefetch" href="/BukkitDevelopmentNoteAlpha/assets/js/8.ecf73e06.js"><link rel="prefetch" href="/BukkitDevelopmentNoteAlpha/assets/js/9.cd5eafec.js">
    <link rel="stylesheet" href="/BukkitDevelopmentNoteAlpha/assets/css/0.styles.47035bf9.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/BukkitDevelopmentNoteAlpha/" class="home-link router-link-active"><!----> <span class="site-name">Bukkit Development Note α</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/BukkitDevelopmentNoteAlpha/home.html" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/BukkitDevelopmentNoteAlpha/contribute.html" class="nav-link">
  贡献
</a></div><div class="nav-item"><a href="/BukkitDevelopmentNoteAlpha/donate.html" class="nav-link">
  赞助
</a></div><div class="nav-item"><a href="https://github.com/BakaRinya/BukkitDevelopmentNoteAlpha" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub仓库
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/BukkitDevelopmentNoteAlpha/home.html" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/BukkitDevelopmentNoteAlpha/contribute.html" class="nav-link">
  贡献
</a></div><div class="nav-item"><a href="/BukkitDevelopmentNoteAlpha/donate.html" class="nav-link">
  赞助
</a></div><div class="nav-item"><a href="https://github.com/BakaRinya/BukkitDevelopmentNoteAlpha" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub仓库
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/BukkitDevelopmentNoteAlpha/home.html" class="sidebar-link">欢迎</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Step1: 基本操作</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/BukkitDevelopmentNoteAlpha/step_1/0-1.html" class="sidebar-link">写在前面</a></li><li><a href="/BukkitDevelopmentNoteAlpha/step_1/1-1.html" class="sidebar-link">认识Java和面向对象</a></li><li><a href="/BukkitDevelopmentNoteAlpha/step_1/1-2.html" class="sidebar-link">编写一个插件</a></li><li><a href="/BukkitDevelopmentNoteAlpha/step_1/0-2.html" class="sidebar-link">后记</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Step2: 语言基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Step3: 开发插件</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/BukkitDevelopmentNoteAlpha/step_3/0-3.html" class="sidebar-link">JavaDoc的使用</a></li><li><a href="/BukkitDevelopmentNoteAlpha/step_3/1-2.html" class="active sidebar-link">事件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/BukkitDevelopmentNoteAlpha/step_3/1-2.html#了解事件" class="sidebar-link">了解事件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/BukkitDevelopmentNoteAlpha/step_3/1-2.html#什么是事件" class="sidebar-link">什么是事件</a></li><li class="sidebar-sub-header"><a href="/BukkitDevelopmentNoteAlpha/step_3/1-2.html#事件有什么用？" class="sidebar-link">事件有什么用？</a></li></ul></li><li class="sidebar-sub-header"><a href="/BukkitDevelopmentNoteAlpha/step_3/1-2.html#监听事件" class="sidebar-link">监听事件</a></li><li class="sidebar-sub-header"><a href="/BukkitDevelopmentNoteAlpha/step_3/1-2.html#客户端与服务端的关系" class="sidebar-link">客户端与服务端的关系</a></li><li class="sidebar-sub-header"><a href="/BukkitDevelopmentNoteAlpha/step_3/1-2.html#查询我们想了解的事件" class="sidebar-link">查询我们想了解的事件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/BukkitDevelopmentNoteAlpha/step_3/1-2.html#事件是怎么取名的" class="sidebar-link">事件是怎么取名的</a></li><li class="sidebar-sub-header"><a href="/BukkitDevelopmentNoteAlpha/step_3/1-2.html#可取消事件与不可取消事件怎么判断" class="sidebar-link">可取消事件与不可取消事件怎么判断</a></li><li class="sidebar-sub-header"><a href="/BukkitDevelopmentNoteAlpha/step_3/1-2.html#找到我们要找的事件" class="sidebar-link">找到我们要找的事件</a></li></ul></li><li class="sidebar-sub-header"><a href="/BukkitDevelopmentNoteAlpha/step_3/1-2.html#并不是所有的事件都能监听" class="sidebar-link">并不是所有的事件都能监听.</a></li></ul></li><li><a href="/BukkitDevelopmentNoteAlpha/step_3/1-1.html" class="sidebar-link">MC的对象化</a></li><li><a href="/BukkitDevelopmentNoteAlpha/step_3/1-3.html" class="sidebar-link">配置API</a></li><li><a href="/BukkitDevelopmentNoteAlpha/step_3/1-4.html" class="sidebar-link">命令执行器</a></li><li><a href="/BukkitDevelopmentNoteAlpha/step_3/1-5.html" class="sidebar-link">开发一个简单的登录插件</a></li><li><a href="/BukkitDevelopmentNoteAlpha/step_3/0-2.html" class="sidebar-link">后记</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="事件"><a href="#事件" class="header-anchor">#</a> 事件</h1> <h2 id="了解事件"><a href="#了解事件" class="header-anchor">#</a> 了解事件</h2> <h3 id="什么是事件"><a href="#什么是事件" class="header-anchor">#</a> 什么是事件</h3> <p>事件是服务器里发生的事.<br>
例如, 天气的变化, 玩家的移动. 玩家把树打掉, 又捡起了掉落地上的原木. 这些都是事件.</p> <p>事件分为可控事件和不可控事件. 其最大区别在于能不能取消(<em>也就是能不能setCancelled</em>).<br>
不难理解, 玩家如果退出服务器, 这不能被取消, 它是不可控事件. 玩家的移动可以被取消, 它是可控事件.</p> <h3 id="事件有什么用？"><a href="#事件有什么用？" class="header-anchor">#</a> 事件有什么用？</h3> <blockquote><p>想象自己正在做一款登录插件, 登录插件是怎么制作出来的呢?<br> <em>本章下方举例将延续这个题设展开.</em></p></blockquote> <p>利用BukkitAPI, 你可以<strong>监听事件</strong>, 事件触发时执行某些代码.<br>
例如, 你可以监听玩家登录服务器, 玩家登录服务器后你可以执行某些代码.</p> <p>那么, 如果你想写登录插件, 你需要监听玩家登录服务器的事件.<br>
玩家进入服务器以后, 记录存储起来他的用户名. 等待玩家输入指令进行登录, 登录完毕以后去掉他的用户名.<br>
然后再监听其他的各种事件(比如监听方块破坏事件), 如果这些事件被触发, 判断是哪个玩家触发的, 看看玩家用户名有没有存储起来, 如果有, 那么他没有登录, 那就把这个事件取消掉.</p> <p>通过这样的例子可以发现, 事件是一个插件最重要的组成部分!</p> <h2 id="监听事件"><a href="#监听事件" class="header-anchor">#</a> 监听事件</h2> <p>上面我们提到可以实现事件触发时执行某些代码. 实现这个目的的方法就是写一个监听器.<br> <strong>监听器实质上是一个实现了<code>Listener</code>的类, 其中包含一些带有<code>@EventHandler</code>注解的方法.</strong></p> <p>我们继续以上面的登录插件作为展开, 写一个“玩家不登录就不允许移动”的插件出来.<br>
因为截止到现在还没有说怎么注册命令, 这里我们设定玩家“只要右键空气就可以登录”.<br> <em>这里我们为了偷懒, 下面把主类直接实现<code>Listener</code>当做监听器用.</em></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloWorldPluginMain</span> <span class="token keyword">extends</span> <span class="token class-name">JavaPlugin</span> <span class="token keyword">implements</span> <span class="token class-name">Listener</span><span class="token punctuation">{</span>
	<span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> playerNameList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//这是没登录玩家列表</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onEnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;Hello World!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token class-name">Bukkit</span><span class="token punctuation">.</span><span class="token function">getPluginManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">registerEvents</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//这里HelloWorld类是监听器, 将当前HelloWorld对象注册监听器  </span>
    <span class="token punctuation">}</span>  
  
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onDisable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>  

	<span class="token comment">/*功能一：刚进入服务器的玩家都记录到“小本本”playerNameList上，他们是没登录的玩家*/</span>
	<span class="token annotation punctuation">@EventHandler</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onPlayerJoin</span><span class="token punctuation">(</span><span class="token class-name">PlayerJoinEvent</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">//玩家登录服务器就会调用这个方法</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>playerNameList<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getPlayer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//先判断这个玩家的名是不是记过了</span>
			playerNameList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getPlayer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//玩家一登录就给他记上名, 代表他没登录</span>
	<span class="token punctuation">}</span>

	<span class="token comment">/*功能二：没登录的玩家不让移动*/</span>
    <span class="token annotation punctuation">@EventHandler</span> <span class="token comment">//这个注解告诉Bukkit这个方法正在监听某个事件</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onPlayerMove</span><span class="token punctuation">(</span><span class="token class-name">PlayerMoveEvent</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">//玩家移动时Bukkit就会调用这个方法</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>playerNameList<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getPlayer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		    e<span class="token punctuation">.</span><span class="token function">setCancelled</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//判断玩家是不是没登录, 是则取消事件</span>
    <span class="token punctuation">}</span>

	<span class="token comment">/*功能三：右击空气登录（本质就是从playerNameList把他删了）*/</span>
	<span class="token annotation punctuation">@EventHandler</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onPlayerInteract</span><span class="token punctuation">(</span><span class="token class-name">PlayerInteractEvent</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">//玩家交互时会调用这个方法(这个下面会解释)</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token class-name">Action</span><span class="token punctuation">.</span>RIGHT_CLICK_AIR<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">//判断是不是右键空气</span>
			playerNameList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getPlayerName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>从上面的代码我们可以看出每一个事件都对应着一个<code>XXXEvent</code>对象. 事件类都以<code>Event</code>作为名称的结尾.<br> <em>稍后会详细讲述如何在JavaDoc找到需要的事件</em>.</p> <p><strong>监听器类里由若干个带<code>@EventHandler</code>注解, 参数仅为一个<code>XXXEvent</code>的方法. 这些事件触发后会触发这些方法, 这就是事件监听的本质.</strong><br>
要特别注意, <strong>监听器中带有<code>@EventHandler</code>的方法一个只能监听某一个事件, 而不能监听多个事件!</strong> 换而言之, 这也就意味着, <strong>你不能填写两个参数, 实现一个方法同时监听两个事件的目的!</strong></p> <p>这里我们用到了玩家交互事件. 这个事件抽象不易理解.<br>
确切的来说, <code>PlayerInteractEvent</code>指的是玩家与方块交互, 交互指的是左右键方块的几乎一切操作. 具体的解释完全可以在JavaDoc中了解到.<br>
如果你曾经用过领地插件<code>Residence</code>, 你肯定对某个领地的权限<code>use</code>印象很深, 这个<code>use</code>权限与<code>PlayerInteractEvent</code>事件差不多, 可以近似认为<code>Residence</code>插件的<code>use</code>权限就是通过监听<code>PlayerInteractEvent</code>写出来的.</p> <p>要注意, <strong>监听器必须要注册才能算生效</strong>!<br>
我们的监听器里的方法都能监听到对应的事件的原因是, 在<code>onEnable</code>方法中, 我们写了这样的代码:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Bukkit</span><span class="token punctuation">.</span><span class="token function">getPluginManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">registerEvents</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//这行代码注册了HelloWorld类为监听器, 如果没有这行代码, 下面所有带@EventHandler注解的方法都不会在事件触发时被调用！</span>
</code></pre></div><p><em>registerEvents方法的第一个参数是监听器，第二个参数是插件主类的实例. 在这里主类就是监听器. 具体你可以在后面了解到.</em></p> <h2 id="客户端与服务端的关系"><a href="#客户端与服务端的关系" class="header-anchor">#</a> 客户端与服务端的关系</h2> <p>如果你实际去使用上面的那个代码, 你可能会发现一个问题: 玩家移动在游戏里还可以移动, 但是一会儿会被服务器&quot;弹回来&quot;.<br>
这样确实是达到了取消玩家移动的目的, 但是, 为什么最终的效果不是&quot;玩家一点都动不了&quot;呢?</p> <p>事实上, 我们无法在服务端取消玩家一点也不能移动.<br>
客户端移动玩家时, 会在客户端显示出移动后的样子, 然后才会传递给服务器玩家移动的信号, 服务端收到客户端的信号后, 服务器才会触发<code>PlayerMoveEvent</code>事件, 做出响应.</p> <p>也就是说, 客户端与服务端之间, 客户端往往都是&quot;先斩后奏&quot;的. 客户端不管你服务端取不取消, 先那么显示出来再说.</p> <p><em>如果要是真的想实现让玩家在服务器的某个坐标一点也动不了, 也许需要发挥你的聪明才智了. 让玩家卡在一个透明方块里? 也许有更好的方案? 现在有人已经实现了!</em><br> <em>目前我们通常利用设置玩家移动速度的方法来让玩家无法移动!</em></p> <h2 id="查询我们想了解的事件"><a href="#查询我们想了解的事件" class="header-anchor">#</a> 查询我们想了解的事件</h2> <h3 id="事件是怎么取名的"><a href="#事件是怎么取名的" class="header-anchor">#</a> 事件是怎么取名的</h3> <p>你可以发现, 玩家移动<code>PlayerMoveEvent</code>、玩家进入服务器<code>PlayerJoinEvent</code>事件都有明显的特征.</p> <ol><li>功能决定名称, 看了名称你就能大致明白它的功能.</li> <li>都以<code>Event</code>作为结尾. 这也就说BukkitAPI中所有名字最后是<code>Event</code>的类都是事件类.</li> <li>开头的第一个词决定作用范围. 例如上面两个类开头都是<code>Player</code>, 这两个类都是与玩家有关的事件类.</li></ol> <p>所有的事件类都在<code>org.bukkit.event</code>包或其子包里.</p> <h3 id="可取消事件与不可取消事件怎么判断"><a href="#可取消事件与不可取消事件怎么判断" class="header-anchor">#</a> 可取消事件与不可取消事件怎么判断</h3> <p>例如<code>PlayerMoveEvent</code>在JavaDoc中, 我们可以注意到这些内容:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PlayerMoveEvent</span>
<span class="token keyword">extends</span> <span class="token class-name">PlayerEvent</span>
<span class="token keyword">implements</span> <span class="token class-name">Cancellable</span>
</code></pre></div><p><code>PlayerMoveEvent</code>事件实现了<code>Cancellable</code>接口.<br> <code>Cancellable</code>中定义了<code>setCancelled</code>方法和<code>isCancelled</code>方法.<br>
通过<code>setCancelled</code>方法, 你可以在事件触发时设置是否取消该事件. 例如, 如果监听玩家移动, 事件触发时使用<code>setCancelled</code>方法, 可以取消玩家移动.<br> <code>isCancelled</code>方法可以判断该事件是否被取消.</p> <p>对于不可取消事件, 它们没有实现<code>Cancellable</code>接口, 因此它们无法被取消.<br>
就像玩家退出服务器, 你总不能像刀剑神域一样, 不让玩家退出服务器吧.</p> <p><em>值得注意的是, 如果玩家并没有改变他的X/Y/Z, 而只是利用鼠标转了一下身, 这也属于玩家移动, 仍会触发<code>PlayerMoveEvent</code>事件.</em></p> <h3 id="找到我们要找的事件"><a href="#找到我们要找的事件" class="header-anchor">#</a> 找到我们要找的事件</h3> <p>我们了解了如何监听事件, 那么我们想做到“不让玩家破坏方块”这个功能, 应该怎么做?<br>
思考后可以发现, 我们需要监听“方块被破坏”这个事件！那破坏方块后触发什么事件? 你需要在JavaDoc中找才能找到！</p> <p>分析: 破坏方块这个事件是一个与方块有关的事件. 打开JavaDoc你可以发现<code>BlockXXXXEvent</code>这类的类有许多.<br>
你也许会说, 玩家破坏方块为什么不是一个与玩家有关的事件呢？很有道理！你也可以在玩家事件中找找看有没有这样的事件.</p> <p>JavaDoc左侧上方是所有的包, 点击<code>org.bukkit.event.block</code>就能在左侧下方看所有与方块有关的事件了.<br>
你可以轻松地发现, 在前几个的位置迅速就能看到<code>BlockBreakEvent</code>, 根据名字就能判断出, 这就是你想找的方块破坏事件, 打开后看到描述为<code>Called when a block is broken by a player.</code>, 很明显, 监听它就对了.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@EventHandler</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onBlockBreak</span><span class="token punctuation">(</span><span class="token class-name">BlockBreakEvent</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
	e<span class="token punctuation">.</span><span class="token function">setCancelled</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这样我们就写出了想要的功能.</p> <h2 id="并不是所有的事件都能监听"><a href="#并不是所有的事件都能监听" class="header-anchor">#</a> 并不是所有的事件都能监听.</h2> <p>在查阅JavaDoc时你可能发现<code>PlayerEvent</code>、<code>BlockEvent</code>这种事件.这些都是不可以被监听的事件.<br>
你不可以通过监听<code>PlayerEvent</code>事件来达到一次性监听所有与玩家有关的事件的目的.<br> <em>它们不能被监听的原因是没有做HandlerList. 在这里不多说明, 后面讲述如何自己做一个自定义事件时你会明白.</em></p> <p>一般来说，如果事件名由两个词构成(例如<code>PlayerEvent</code>)都不能监听, 大多数事件都可以监听.</p> <p>你可能好奇, 常见的登录插件都是把所有需要的玩家事件都写了<code>@EventHandler</code>注解方法一个个监听的？<br>
答案是, 的确如此. 你要想写登录插件, 你就应该去监听许许多多事件, 累也没办法, 就得这样写.</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/BukkitDevelopmentNoteAlpha/step_3/0-3.html" class="prev">
        JavaDoc的使用
      </a></span> <span class="next"><a href="/BukkitDevelopmentNoteAlpha/step_3/1-1.html">
        MC的对象化
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/BukkitDevelopmentNoteAlpha/assets/js/app.e1f3861f.js" defer></script><script src="/BukkitDevelopmentNoteAlpha/assets/js/2.cc6e75aa.js" defer></script><script src="/BukkitDevelopmentNoteAlpha/assets/js/25.dff2cf05.js" defer></script>
  </body>
</html>
